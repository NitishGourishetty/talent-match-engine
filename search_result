import json
import numpy as np
from openai import OpenAI
from typing import List, Dict
import os

client = OpenAI(api_key=os.getenv('OPENAI_API_KEY'))

def get_searchable_text(resume: Dict) -> Dict[str, str]:
    education_texts = [
        text for edu in resume.get('education', [])
        for text in [edu.get('degree', ''), edu.get('field', ''), edu.get('school', '')]
        if text
    ]
    
    # focus on recent
    experience_texts = [
        text for exp in resume.get('experience', [])[:3]
        for text in [
            exp.get('title', ''),
            exp.get('company', ''),
            ' '.join(exp.get('responsibilities', []))
        ]
        if text
    ]
    
    skills = resume.get('skills', {})
    
    return {
        'education': ' '.join(education_texts),
        'experience': ' '.join(experience_texts),
        'technical_skills': ' '.join(skills.get('technical', [])),
        'soft_skills': ' '.join(skills.get('soft', []))
    }

